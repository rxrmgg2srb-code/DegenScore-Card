// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model DegenCard {
  id              String    @id @default(cuid())
  walletAddress   String    @unique
  
  // Métricas básicas
  degenScore      Int
  totalTrades     Int
  totalVolume     Float
  profitLoss      Float
  winRate         Float
  bestTrade       Float
  worstTrade      Float
  avgTradeSize    Float
  totalFees       Float
  tradingDays     Int
  level           Int
  xp              Int
  
  // Métricas avanzadas
  rugsSurvived    Int       @default(0)
  rugsCaught      Int       @default(0)
  totalRugValue   Float     @default(0)
  moonshots       Int       @default(0)
  avgHoldTime     Float     @default(0)
  quickFlips      Int       @default(0)
  diamondHands    Int       @default(0)
  realizedPnL     Float     @default(0)
  unrealizedPnL   Float     @default(0)
  firstTradeDate  DateTime?
  longestWinStreak Int      @default(0)
  longestLossStreak Int     @default(0)
  volatilityScore Float     @default(0)
  
  // Datos sociales/perfil
  displayName     String?
  twitter         String?
  telegram        String?
  profileImage    String?
  
  // Estado
  isMinted        Boolean   @default(false)
  isPaid          Boolean   @default(false)
  mintedAt        DateTime  @default(now())
  lastSeen        DateTime  @default(now())
  
  // Timestamps
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  // Sistema de Likes
  likes           Int       @default(0)
  
  // Relaciones
  badges          Badge[]
  
  @@index([degenScore])
  @@index([totalVolume])
  @@index([winRate])
  @@index([isPaid])
  @@index([likes])
}

model Badge {
  id          String     @id @default(cuid())
  name        String
  description String
  icon        String
  rarity      String
  cardId      String
  card        DegenCard  @relation(fields: [cardId], references: [id], onDelete: Cascade)
  
  @@index([cardId])
}

model Payment {
  id            String   @id @default(cuid())
  walletAddress String
  amount        Float
  signature     String   @unique
  status        String
  createdAt     DateTime @default(now())
  
  @@index([walletAddress])
  @@index([signature])
}

model GlobalStats {
  id            String   @id @default("singleton")
  totalCards    Int      @default(0)
  totalMinted   Int      @default(0)
  totalVolume   Float    @default(0)
  avgDegenScore Float    @default(0)
  topScore      Int      @default(0)
  updatedAt     DateTime @updatedAt
}